# FinalPersonalProject
https://github.com/zif1519


# 게임제목 : 내가 인벤토리 속 아이템이 되었던 건에 대하여

# StartScene.. (제작소요시간   !!!!    5분   !!!!     그냥 버튼 몇개와 Text.. )
스타트 씬은 이런 내용으로 이미지들과 게임 컨셉에 대한 설명부분이 들어간다면 좋지 않을까를 보여주는 화면입니다..
제출 1시간 전에 Readme 작성하면서 필수과제라는 사실을 알게 되어서 넣긴 했습니다. ㅋㅋㅋ

게임 컨셉은
게임 로딩중에 주인공이 <업데이트중인 버그인벤토리> 를 훔쳐서 자기 인벤에 넣었는데, 그걸 걸려서 삭제위기에 처하게 되어
도망칠 곳을 찾다가, 아까 훔친것으로 생각했던 인벤토리가 다시 보여서 그 안으로 숨어버리는 과정에서   나 -> 인벤 -> 그속의나 -> 그속의나의인벤 -> 또그속의나 -> ...
가 반복되는 

이 버그속 공간에서 탈출을 꾀하는 탈출게임을 만들려고 했습니다..

1. 함부로 버블을 깨면 인벤속에 있는 내가 죽어버리기 때문에 깨부시면 Bad엔딩
2. 버블 하단에 탈출구가 있다는걸 스토리상 알게되고, 버블 하단부로 가서 버블의 문을 열고 그 아래로 뛰어내리면? 거대 생명체들이 살고있는 세계로 (다음버블) 떨어져서 거대개미에게 잡아먹히면서 끝 -> Bad엔딩
3. small 버블을 손에 든채로 버블 하단부로 가서 버블의 문을 열고 그아래로 뛰어내리면? 거대한 나의 손안에 내가 뛰어내림..
   -> (스토리상 자연스럽게 주인공에게 알려줄 게임안의 룰에는 거대화된 물체와 본래크기의 물체가 만나면 본래크기의 물체의 정보가 거대화된 물체에게 이전되며 본래크기물체는 사라진다.)
   -> 지금 게이머가 조종할수 있던 나 -> 존재하는 '나' 중 가장 큰 '나' 가 되며, 마지막으로 가장 큰 버블밖으로 나와지며 게임이 끝난다 -> 진짜 엔딩.....

   
# 게임제작 중 힘들었던 부분
### Cinemachine 이해하기 < 대략 6시간 소모 ㅋㅋ >
강의에서 배운 Cinemachine의 경우 처음 사용해보는 컴포넌트여서 그 안의 설정들을 스크립트로 어떻게 조작하는지 이해하기 어려웠다.
나는 게임 시작시에 바로 Cursor가 lock 되는 형태를 싫어하고 마우스 우클릭 시에만 카메라의 각도가 전환되는 게임을 좋아하기 때문에. (3D 게임에 멀미가 심해서)
새로운 카메라의 움직임이 필요했는데, 시네머신의 변수들을 조작하는 방법을 몰랐다.


결국 나중에 CinemachinePOV, CinemachineComposer 등의 존재들을 찾게 되었고, 이들의 변수들을 바꾸는 방법을 알게 되었다.

최종 구현 -> CinemachinePOV 의  버티컬,호리즌탈 뎀퍼맥스값을 조절하는 방식을 통해서 마우스 우클릭시에 커서락모드가 되며 뎀퍼값이 5가되고, 우클릭 해제시 락모드가 해제되고 뎀퍼값이 0이 되도록
조절해서 구현했다.

### 컨셉이 논리적으로 맞도록 상상하기
#### 컨셉 설명 < 시간 상당히 소모 >
컨셉이 땅에 떨어진 인벤토리를 내가 주웠는데, 그 자리에 인벤토리가 다시 생성된 상황, 그리고 내가 그 인벤토리 속으로 숨어서 게임이 시작된다는 컨셉이다.
이 경우 거울을 거울에 비친것과 같이, 나는 인벤토리 속에 있는데, 그 인벤토리는 내가 가지고 있는 인벤토리이므로, 그 인벤토리 속에는 또 다른 내가 존재한다는
컨셉이다.
#### 컨셉 구현
1. 메인카메라
이 컨셉을 위해서는 우선 여러개의 카메라가 필요했다. 우선 메인 카메라는 현재 내가 존재하는 세상을 비추어야 한다. 이는 인벤토리속에 숨은 '나'라는 캐릭터가 존재하는 공간이다.
게임에서는 하나의 큰 버블을 그려넣었고, 이 버블속에 내가 갇혀있다는 개념이다.
2. 세컨드 카메라
나는 내 인벤토리를 바라볼 수 있어야 했다. 당연히 그 인벤토리는 나라는 존재가 들어가 있는 상태여야 했다. 그래서 그걸 구현하기 위해, 엄청 밖의 위치에서 큰 버블을 비추는 카메라가
만들어내는 영상을 찍어서, 그 영상을 인벤토리라는 오브젝트의 표면에 보이도록 설정을 했다.
3. 서드 카메라
인벤토리속의 내가('작은나') 인벤토리 밖의 나 ('나')를 쳐다보는 경우에는 '나' 도 큰 버블 밖의 나('큰나')를 쳐다봐야 했다. 그래서 작은 버블 속에 카메라를 두고,
그 카메라의 영상을 찍어서, 메인 카메라의 skybox 부분으로 사용을 했다.
 

### 작은 인벤토리속의 세상 구현하기 < RenderTexture 이해하기 3시간, 셰이더로 날린시간 6시간, 해결법 찾는데 +1일 날림...>
컨셉의 가장 중요한 부분을 차지하는 인벤토리속 아이템인 '나' 를 표현하기 위해 만들어낸 smallBall 이라는 오브젝트를 구현하기가 어려웠다
서브 카메라로 캐릭터가 존재하는 공간을 밖의 먼 거리에서 촬영하도록 하여 Render Texture를 생성하고, 그 렌더 텍스쳐를 이용해서 구의 표면에
보이도록 하려고 했으나, 이게 셰이더 작업이 필요한 관계로 구현하기가 너무 어려웠다. 시간은 짧고 셰이더의 내용은 너무 많았다.
해결방법 : 정말 엄청나게 많은 시도 끝에 최종적으로 선택한 것은 구 속에 카메라 방향의 수직한 평면을 비출수 있는 얇은 원판을 구현하자는 것이었다.
원판은 카메라의 방향을 실시간으로 추적하여 그에 수직한 방향을 보이도록 하여, 마치 구를 쳐다보는 착각을 일으키도록 구현했다.
각도를 구현하는 도중에 계속 반전이 일어나거나 원하는 각도가 안나왔는데 나중에 그냥 이각 저각을 곱하다가 (270f, 270f, 270f)의 오일러각을
가지는 쿼터니언을 곱해주니 잘 되었다... 이게 왜 되는거야?? (슬프지만 수학적 회전인 관계로 지금은 바빠서 분석은 패스)
결과적으로는 원하는 모습을 구현하는데 성공했다.

### 인벤토리UI 리펙토링
이전의 과제에서 쓰던 인벤토리는 모든 함수들이 정리가 되지 않고 사용되고 있었다..
이번에 과감히 이전의 쓰던 인벤토리를 뜯어서 UI 부분과 Data부분, MonoBehaviour로 남겨야 하는 부분들을 구분해서 
리펙토링을 시도했다....가... 난리가 났다.. ㅋㅋㅋ

#### 리펙토링 방식
우선 리펙토링 과정에서 InventoryUI 는 Inventory개념이 들어가는 UI 들이 늘어날 때마다 추가를 하고, Inventory 는 타입을 나누어
캐릭터, 상점, 크래프팅박스 등에 사용할 예정이다. InventorySO는 인벤토리 Data를 따로 저장하는 그릇의 용도이다.

#### 1. Data는 InventorySO가 갖도록
InventorySO는 최종적으로 게임에 사용되는 Inventory개념이 이용되는 모든 오브젝트들의 저장되어야 하는 데이터의 보관장소가 된다.
따라서 게임의 저장/로드 기능이 추가되는 경우에는 이러한 InventorySO의 정보만을 저장하면 되도록 만들 예정이다.

#### 2. UI 관련된 부분은 InventoryUI에 전부 이동
Inventory 개념을 이용하는 모든 UI 요소들은 전부 프리팹화 할 예정이다.
프리팹화 하는 과정에서 각각의 UI 요소들은 최상위 객체에 InventoryUI 와 같은 UI스크립트를 부착시켜 하위의 UI요소들과의 연결을
시켜놓은 채로 관리하려고 한다. 이렇게 만들어 놓으면, Player를 바꿔서 새롭게 게임을 만들게 되어도 InventoryUI 내부의 연결과는 무관하여
새롭게 연결시켜야 하는건 단순히 캐릭터에 Inventory 컴포넌트만 넣어주고 그 Inventory를 Display해줄 UI 요소를 찾는 방법만 만들어주면 된다

#### 3. 동작들에 관련된 부분은 Inventory : MonoBehaviour 로 남기기
MonoBehaviour의 경우, InventorySO의 데이터를 이용해서 실질적으로 게임을 플레이 할수 있도록 하는 모든 함수들을 정의해 놓는다.

#### 4. 고민되는 부분
인터페이스와 슈퍼클래스나 추상클레스등을 두어 관리를 해야할지, 그냥 매번 새로운 클래스로 만들지 고민된다.
인벤토리의 경우 리펙토링 과정에서, 이렇게 분리를 할 필요성이 과연 큰가? 에 대한 고민을 많이 하게되었다. 내가 구현할 게임에서
캐릭터를 여러개 두어, 여러개의 캐릭터들이 전환되면서 하나의 인벤토리 UI를 공유해서 사용하는 방식으로 구현할 것도 아니어서
리펙토링에 회의감을 갖는 시기가 왔는데,
같은 맥락에서 UI요소가 추가되어도, 보관함, 상점, 요리대, 작업대 정도의 개념 이상으로 더 확장될 것도 없는 제한적인 개념에서
굳이 부모클래스와 interface 등을 억지로 추가할 필요가 있을까? 라는 고민이 생겼다.

#### ItemSlot을 옵저버 패턴화 시켜서 ItemSlot의 변경에 UI들이 Refresh를 하도록 변경
리펙토링 과정에서 Data 를 SO로 분리시킴과 동시에 그 Data들에는 각각 자기 상태가 변하면 알림을 보내는 방식으로 옵저버 패턴을
적용시켜 보기로 했다. 인벤토리에서 가장 기본이 되는 중요한 그릇이 ItemSlot 클래스라고 생각된다.
따라서 ItemSlot의 필드 값들은 ItemSlot내부의 함수들에 의해서만 변화되도록 캡슐화하고, 필드 값이 변경되는 경우에는
자신의 데이터가 변경되었음을 알리는 Call함수와, 그 Call함수가 호출될때마다 호출될 Event를 두어 누군가가 그 Event에
구독할 수 있도록 만들었다.

따라서 UI에서는 초기화 과정 중 ItemSlotUI들과 ItemSlot을 연결 시키는 부분에서 ItemSlot Event에 UISlot의 Refresh 동작을
등록해두어 InventoryUI, CraftingUI 등 여러 UI패널에서 Inventory의 정보를 불러오거나 변경을 할때에 제대로 변경이 반영되지
못해서 생기는 오류들은 방지 할 수 있다.

## 현실....은... 시간이 부족해....

![SmallBallGIF](https://github.com/Zif1519/FinalPersonalProject/assets/141081153/a1408da2-e59c-459d-9d06-e66651efdd31)
